registrationModule.controller("notificacionController",function(e,r,t,n,a,i,o,c){e.oneAtATime=!0,e.isSearching=!1,e.alphaOrder=!1,e.tooltipAlphabeth="Ordenar Descencente",e.dateOrder=!0,e.tooltipDate="Ordenar Ascendente",e.currentOrder=1,e.filtrado=!1,e.nivelCascada=1,e.socket=null,e.connected=!1,e.init=function(){if(t.actualizar=!0,e.currentMarca=null,e.hora=new Date,e.txtAlphaOrder="+identificador",e.txtDateOrder="-fecha",setInterval(function(){e.ReloadTime()},1e3),setInterval(function(){$(".parpadear").toggle("highlight")},500),t.currentEmployee=getParameterByName("id"),""==t.currentEmployee){var r=prompt("Ingrese un número de empleado",1);t.currentEmployee=r}c.getEmpleado(t.currentEmployee).success(d).error(s),t.Reload(),D(),setInterval(function(){e.connected||""==t.currentEmployee||(console.log("Intentando reconexión..."),l())},1e4)};var l=function(){e.socket=io.connect(global_settings.urlSocket),null!=e.socket&&u()},u=function(){e.socket.emit("login",{user:t.empleado}),e.socket.on("hello",function(r){console.log(r.mensaje),e.connected=!0}),e.socket.on("pkgNotificacion",function(e){console.log(e.length+" dato(s) recibido(s) at: "+(new Date).toString()),p(e,null,null,null)}),e.socket.on("disconnect",function(){console.log("Se ha desconectado."),e.connected=!1})},s=function(e,r,t,n){a.error("Ocurrio un problema: "+e),$("#btnReject").button("reset"),$("#btnApprove").button("reset")},d=function(e,r,n,a){t.empleado=e,l()},p=function(r,n,i,o){if(null!=e.listaNotificacion_original){var c=e.listaNotificacion_original.length;t.actualizar&&(e.listaNotificacion_original=r,f(),1==e.currentOrder?A():h(),r.length>c&&a.info((r.length-c).toString()+" nuevas notificaciones."))}else e.listaNotificacion_original=r,f()},f=function(){null!=e.currentMarca&&null!=e.currentAgencia&&null!=e.currentDepartamento?e.listaNotificacion=r("filter")(e.listaNotificacion_original,{idEmpresa:e.currentMarca.emp_idempresa,idSucursal:e.currentAgencia.suc_idsucursal,idDepartamento:e.currentDepartamento.dep_iddepartamento},!0):null!=e.currentMarca&&null!=e.currentAgencia?e.listaNotificacion=r("filter")(e.listaNotificacion_original,{idEmpresa:e.currentMarca.emp_idempresa,idSucursal:e.currentAgencia.suc_idsucursal},!0):null!=e.currentMarca?e.listaNotificacion=r("filter")(e.listaNotificacion_original,{idEmpresa:e.currentMarca.emp_idempresa},!0):e.listaNotificacion=e.listaNotificacion_original},m=function(r,t,n,a){if(null!=e.listaAprobacion_original){var i=e.listaAprobacion_original.length;r.length!=i&&(e.listaAprobacion_original=r,g(),1==e.currentOrder?A():h())}else e.listaAprobacion_original=r,g()},g=function(){null!=e.currentMarca&&null!=e.currentAgencia&&null!=e.currentDepartamento?e.listaAprobacion=r("filter")(e.listaAprobacion_original,{idEmpresa:e.currentMarca.emp_idempresa,idSucursal:e.currentAgencia.suc_idsucursal,idDepartamento:e.currentDepartamento.dep_iddepartamento},!0):null!=e.currentMarca&&null!=e.currentAgencia?e.listaAprobacion=r("filter")(e.listaAprobacion_original,{idEmpresa:e.currentMarca.emp_idempresa,idSucursal:e.currentAgencia.suc_idsucursal},!0):null!=e.currentMarca?e.listaAprobacion=r("filter")(e.listaAprobacion_original,{idEmpresa:e.currentMarca.emp_idempresa},!0):e.listaAprobacion=e.listaAprobacion_original};t.Reload=function(){i.get(t.currentEmployee).success(p).error(s),o.get(t.currentEmployee).success(m).error(s)},e.VerDocumento=function(e){var r=e.adjunto,t=r.split("|");t.forEach(function(r){var t=window.open(e.ruta_archivos+r,"_blank","toolbar=yes, scrollbars=yes, resizable=yes, top=500, left=500, width=1024, height=768")})},e.VerBusiness=function(e){var r=window.open(e.link,"_blank","toolbar=yes, scrollbars=yes, resizable=yes, top=500, left=500, width=1024, height=768")},e.ReloadTime=function(){e.hora=new Date,e.$apply()},e.Visto=function(e){t.actualizar=!e.open,0==e.estado&&(o.visto(t.currentEmployee,e.idAprobacion).error(s),e.estado=1)},e.ViewSearch=function(){e.isSearching=!e.isSearching,$("#slideIzq").animate({width:"toggle"}),0==e.isSearching&&($("#slideIzq").blur(),$("#slideIzq").val(""),e.keySearch="")},e.TextSearch=function(){e.keySearch=$("#slideIzq").val()},e.AlphaOrder=function(){e.currentOrder=2,e.alphaOrder=!e.alphaOrder,1==e.alphaOrder?(e.tooltipAlphabeth="Ordenar Ascendente",e.txtAlphaOrder="-identificador",h()):(e.tooltipAlphabeth="Ordenar Descencente",e.txtAlphaOrder="+identificador",h())};var h=function(){e.listaNotificacion=r("orderBy")(e.listaNotificacion,e.txtAlphaOrder),e.listaAprobacion=r("orderBy")(e.listaAprobacion,e.txtAlphaOrder)};e.DateOrder=function(){e.currentOrder=1,e.dateOrder=!e.dateOrder,1==e.dateOrder?(e.tooltipDate="Ordenar Ascendente",e.txtDateOrder="-fecha",A()):(e.tooltipDate="Ordenar Descencente",e.txtDateOrder="+fecha",A())};var A=function(){e.listaNotificacion=r("orderBy")(e.listaNotificacion,e.txtDateOrder),e.listaAprobacion=r("orderBy")(e.listaAprobacion,e.txtDateOrder)};e.ViewFiltro=function(){$("#modalFiltro").modal("show")},e.AplicarFiltro=function(){e.filtrado=!0,f(),g(),$("#modalFiltro").modal("hide")},e.QuitarFiltro=function(){e.filtrado=!1,e.nivelCascada=1,e.currentMarca=null,e.currentAgencia=null,e.currentDepartamento=null,f(),g(),$("#modalFiltro").modal("hide")};var b=function(r,t,n,a){e.listaMarca=r},_=function(r,t,n,a){e.listaAgencia=r},O=function(r,t,n,a){e.listaDepartamento=r},D=function(){c.getMarca(t.currentEmployee).success(b).error(s)};e.GetAgencia=function(){c.getAgencia(t.currentEmployee,e.currentMarca.emp_idempresa).success(_).error(s)},e.GetDepartamento=function(){c.getDepartamento(t.currentEmployee,e.currentMarca.emp_idempresa,e.currentAgencia.suc_idsucursal).success(O).error(s)},e.SetMarca=function(r){e.currentMarca=r,e.GetAgencia(),e.nivelCascada=2,e.currentAgencia=null,e.currentDepartamento=null},e.SetAgencia=function(r){e.currentAgencia=r,e.GetDepartamento(),e.nivelCascada=3,e.currentDepartamento=null},e.SetDepartamento=function(r){e.currentDepartamento=r}});